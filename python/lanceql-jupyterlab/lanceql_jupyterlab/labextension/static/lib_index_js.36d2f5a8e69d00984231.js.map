{"version":3,"file":"lib_index_js.36d2f5a8e69d00984231.js","mappings":"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","sources":["webpack://lanceql-jupyterlab/./src/index.ts"],"sourcesContent":["import {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\n\nimport { IRenderMimeRegistry } from '@jupyterlab/rendermime';\n\nimport { INotebookTracker } from '@jupyterlab/notebook';\n\nimport { IRenderMime } from '@jupyterlab/rendermime-interfaces';\n\nimport { Widget } from '@lumino/widgets';\n\nimport { Kernel, KernelMessage } from '@jupyterlab/services';\n\n/**\n * The MIME type for LanceQL virtual tables.\n */\nconst MIME_TYPE = 'application/vnd.lanceql.table+json';\n\n/**\n * Interface for column type metadata.\n */\ninterface IColumnType {\n  type: string;\n  dtype: string;\n  dim?: number;\n  model?: string;\n}\n\n/**\n * Interface for the table data from Python.\n */\ninterface ITableData {\n  source_id: string;\n  total: number;\n  columns: string[];\n  column_types: Record<string, IColumnType>;\n  image_columns: string[];\n  rows: Record<string, unknown[]>;\n}\n\n/**\n * Interface for row response from Comm.\n */\ninterface IRowsResponse {\n  chunks: Array<{\n    offset: number;\n    rows: Record<string, unknown[]>;\n  }>;\n}\n\n/**\n * Global kernel reference - set by the plugin when notebooks are active.\n */\nlet _currentKernel: Kernel.IKernelConnection | null = null;\n\n/**\n * Global image preview element - shared across all tables.\n */\nlet _globalPreview: HTMLDivElement | null = null;\n\nfunction getGlobalPreview(): HTMLDivElement {\n  if (!_globalPreview) {\n    _globalPreview = document.createElement('div');\n    _globalPreview.className = 'lq-global-preview';\n    _globalPreview.style.cssText = `\n      display: none;\n      position: fixed;\n      z-index: 99999;\n      background: white;\n      border: 1px solid #ccc;\n      border-radius: 4px;\n      padding: 8px;\n      box-shadow: 0 4px 16px rgba(0,0,0,0.25);\n      pointer-events: none;\n    `;\n    document.body.appendChild(_globalPreview);\n  }\n  return _globalPreview;\n}\n\n/**\n * Virtual table renderer widget.\n */\nclass VirtualTableWidget extends Widget implements IRenderMime.IRenderer {\n  private _data: ITableData | null = null;\n  private _cache: Map<number, Record<string, unknown[]>> = new Map();\n  private _comm: Kernel.IComm | null = null;\n  private _pendingRanges: Set<number> = new Set();\n\n  private _scrollContainer: HTMLDivElement | null = null;\n  private _rowsContainer: HTMLDivElement | null = null;\n  private _statusEl: HTMLDivElement | null = null;\n\n  private readonly ROW_HEIGHT = 32;\n  private readonly CHUNK_SIZE = 50;\n  private readonly BUFFER = 10;\n\n  constructor(options: IRenderMime.IRendererOptions) {\n    super();\n    this.addClass('lanceql-virtual-table');\n  }\n\n  async renderModel(model: IRenderMime.IMimeModel): Promise<void> {\n    const data = model.data[MIME_TYPE] as unknown as ITableData;\n    if (!data) {\n      this.node.textContent = 'No data';\n      return;\n    }\n\n    this._data = data;\n    this._cache.set(0, data.rows);\n\n    this._buildUI();\n    await this._initComm();\n    this._render();\n  }\n\n  private _buildUI(): void {\n    if (!this._data) return;\n\n    const container = document.createElement('div');\n    container.className = 'lq-container';\n\n    // Header with type badges\n    const header = document.createElement('div');\n    header.className = 'lq-header';\n    for (const col of this._data.columns) {\n      const cell = document.createElement('span');\n      cell.className = 'lq-cell';\n\n      const colName = document.createElement('span');\n      colName.className = 'lq-col-name';\n      colName.textContent = col;\n      cell.appendChild(colName);\n\n      // Add type badge\n      const colType = this._data.column_types?.[col];\n      if (colType) {\n        const badge = document.createElement('span');\n        badge.className = `lq-type-badge lq-type-${colType.type}`;\n        if (colType.type === 'vector' && colType.model) {\n          badge.textContent = colType.model;\n          badge.title = `${colType.dim}d vector (${colType.dtype})`;\n        } else {\n          badge.textContent = colType.type;\n          badge.title = colType.dtype;\n        }\n        cell.appendChild(badge);\n      }\n\n      header.appendChild(cell);\n    }\n    container.appendChild(header);\n\n    // Scroll container\n    this._scrollContainer = document.createElement('div');\n    this._scrollContainer.className = 'lq-scroll';\n\n    const spacer = document.createElement('div');\n    spacer.className = 'lq-spacer';\n    spacer.style.height = `${this._data.total * this.ROW_HEIGHT}px`;\n\n    this._rowsContainer = document.createElement('div');\n    this._rowsContainer.className = 'lq-rows';\n    spacer.appendChild(this._rowsContainer);\n\n    this._scrollContainer.appendChild(spacer);\n    container.appendChild(this._scrollContainer);\n\n    // Status bar\n    this._statusEl = document.createElement('div');\n    this._statusEl.className = 'lq-status';\n    this._statusEl.textContent = `${this._data.total.toLocaleString()} rows`;\n    container.appendChild(this._statusEl);\n\n    this.node.appendChild(container);\n\n    // Scroll listener\n    let scrollTimeout: number | null = null;\n    this._scrollContainer.addEventListener('scroll', () => {\n      if (scrollTimeout) window.clearTimeout(scrollTimeout);\n      scrollTimeout = window.setTimeout(() => this._render(), 16);\n    });\n  }\n\n  private async _initComm(): Promise<void> {\n    if (!this._data) {\n      this._updateStatus('(no data)');\n      return;\n    }\n\n    // Try to get kernel - may need to wait for it\n    let kernel = _currentKernel;\n    if (!kernel) {\n      // Wait a bit for kernel to be available\n      await new Promise(resolve => setTimeout(resolve, 500));\n      kernel = _currentKernel;\n    }\n\n    if (!kernel) {\n      this._updateStatus('(static mode - no kernel)');\n      console.warn('LanceQL: No kernel available for Comm');\n      return;\n    }\n\n    try {\n      this._comm = kernel.createComm('lanceql_display');\n\n      this._comm.onMsg = (msg: KernelMessage.ICommMsgMsg) => {\n        const data = msg.content.data as unknown as IRowsResponse;\n        if (data.chunks) {\n          for (const chunk of data.chunks) {\n            this._cache.set(chunk.offset, chunk.rows);\n            this._pendingRanges.delete(chunk.offset);\n          }\n          this._render();\n        }\n      };\n\n      await this._comm.open({ source_id: this._data.source_id });\n      this._updateStatus('');\n    } catch (e) {\n      console.warn('LanceQL: Comm init failed:', e);\n      this._updateStatus('(comm failed)');\n    }\n  }\n\n  private _updateStatus(extra: string): void {\n    if (this._statusEl && this._data) {\n      const base = `${this._data.total.toLocaleString()} rows`;\n      this._statusEl.textContent = extra ? `${base} ${extra}` : base;\n    }\n  }\n\n  private _render(): void {\n    if (!this._data || !this._scrollContainer || !this._rowsContainer) return;\n\n    const scrollTop = this._scrollContainer.scrollTop;\n    const viewHeight = this._scrollContainer.clientHeight;\n\n    const startRow = Math.max(0, Math.floor(scrollTop / this.ROW_HEIGHT) - this.BUFFER);\n    const visibleCount = Math.ceil(viewHeight / this.ROW_HEIGHT) + this.BUFFER * 2;\n    const endRow = Math.min(this._data.total, startRow + visibleCount);\n\n    let html = '';\n    for (let i = startRow; i < endRow; i++) {\n      const row = this._getRow(i);\n      if (row) {\n        html += `<div class=\"lq-row\" style=\"top:${i * this.ROW_HEIGHT}px\">`;\n        for (const col of this._data.columns) {\n          const val = row[col];\n          const colType = this._data.column_types?.[col];\n\n          if (val === null || val === undefined) {\n            html += '<span class=\"lq-cell\"></span>';\n          } else if (colType?.type === 'vector' && Array.isArray(val)) {\n            // Render sparkline for vectors\n            const sparkline = this._renderSparkline(val as number[], colType.dim || val.length);\n            html += `<span class=\"lq-cell lq-vector-cell\" data-vector=\"${this._escapeHtml(JSON.stringify(val))}\" data-dim=\"${colType.dim || val.length}\" data-model=\"${colType.model || ''}\">`;\n            html += sparkline;\n            html += '</span>';\n          } else if (this._data.image_columns.includes(col) && typeof val === 'string') {\n            const shortUrl = val.length > 30 ? val.substring(0, 30) + '...' : val;\n            html += `<span class=\"lq-cell lq-img-cell\" data-img-url=\"${this._escapeHtml(val)}\">`;\n            html += `<a href=\"${this._escapeHtml(val)}\" target=\"_blank\" title=\"${this._escapeHtml(val)}\">${this._escapeHtml(shortUrl)}</a>`;\n            html += '</span>';\n          } else {\n            html += `<span class=\"lq-cell\">${this._escapeHtml(String(val))}</span>`;\n          }\n        }\n        html += '</div>';\n      } else {\n        html += `<div class=\"lq-row lq-loading\" style=\"top:${i * this.ROW_HEIGHT}px\">`;\n        html += '<span class=\"lq-cell\">Loading...</span>';\n        html += '</div>';\n      }\n    }\n\n    this._rowsContainer.innerHTML = html;\n    this._setupImagePreviews();\n    this._setupVectorPreviews();\n    this._fetchMissing(startRow, endRow);\n  }\n\n  private _getRow(idx: number): Record<string, unknown> | null {\n    const chunkStart = Math.floor(idx / this.CHUNK_SIZE) * this.CHUNK_SIZE;\n    const rows = this._cache.get(chunkStart);\n    if (!rows) return null;\n\n    const localIdx = idx - chunkStart;\n    const result: Record<string, unknown> = {};\n\n    for (const col of this._data!.columns) {\n      const colData = rows[col];\n      result[col] = colData ? colData[localIdx] : null;\n    }\n\n    return result;\n  }\n\n  private _fetchMissing(start: number, end: number): void {\n    if (!this._comm || !this._data) return;\n\n    const ranges: Array<{ offset: number; limit: number }> = [];\n\n    for (\n      let chunk = Math.floor(start / this.CHUNK_SIZE) * this.CHUNK_SIZE;\n      chunk < end;\n      chunk += this.CHUNK_SIZE\n    ) {\n      if (!this._cache.has(chunk) && !this._pendingRanges.has(chunk)) {\n        ranges.push({ offset: chunk, limit: this.CHUNK_SIZE });\n        this._pendingRanges.add(chunk);\n      }\n    }\n\n    if (ranges.length > 0) {\n      this._comm.send({\n        action: 'fetch_rows',\n        source_id: this._data.source_id,\n        ranges: ranges\n      });\n    }\n  }\n\n  private _escapeHtml(s: string): string {\n    return s\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;');\n  }\n\n  private _renderSparkline(values: number[], dim: number): string {\n    // Sample values if too many\n    const maxPoints = 60;\n    let sampled = values;\n    if (values.length > maxPoints) {\n      const step = Math.floor(values.length / maxPoints);\n      sampled = [];\n      for (let i = 0; i < values.length; i += step) {\n        sampled.push(values[i]);\n      }\n    }\n\n    // Normalize values to 0-20 range for SVG height\n    const min = Math.min(...sampled);\n    const max = Math.max(...sampled);\n    const range = max - min || 1;\n    const normalized = sampled.map(v => 20 - ((v - min) / range) * 18);\n\n    // Build SVG path\n    const width = 80;\n    const step = width / (normalized.length - 1 || 1);\n    let path = `M0,${normalized[0].toFixed(1)}`;\n    for (let i = 1; i < normalized.length; i++) {\n      path += ` L${(i * step).toFixed(1)},${normalized[i].toFixed(1)}`;\n    }\n\n    return `<svg class=\"lq-sparkline\" width=\"80\" height=\"20\" viewBox=\"0 0 80 20\">\n      <path d=\"${path}\" fill=\"none\" stroke=\"#6366f1\" stroke-width=\"1.5\"/>\n    </svg><span class=\"lq-dim-label\">${dim}d</span>`;\n  }\n\n  private _setupImagePreviews(): void {\n    if (!this._rowsContainer) return;\n\n    const preview = getGlobalPreview();\n    const imgCells = this._rowsContainer.querySelectorAll('.lq-img-cell');\n\n    imgCells.forEach((cell) => {\n      const url = (cell as HTMLElement).dataset.imgUrl;\n      if (!url) return;\n\n      cell.addEventListener('mouseenter', () => {\n        preview.innerHTML = `<img src=\"${url}\" style=\"max-width:300px;max-height:200px;display:block;\">`;\n        preview.style.display = 'block';\n      });\n\n      cell.addEventListener('mousemove', (e: Event) => {\n        const me = e as MouseEvent;\n        preview.style.left = `${me.clientX + 15}px`;\n        preview.style.top = `${me.clientY + 15}px`;\n      });\n\n      cell.addEventListener('mouseleave', () => {\n        preview.style.display = 'none';\n      });\n    });\n  }\n\n  private _setupVectorPreviews(): void {\n    if (!this._rowsContainer) return;\n\n    const preview = getGlobalPreview();\n    const vectorCells = this._rowsContainer.querySelectorAll('.lq-vector-cell');\n\n    vectorCells.forEach((cell) => {\n      const vectorStr = (cell as HTMLElement).dataset.vector;\n      const dim = (cell as HTMLElement).dataset.dim;\n      const model = (cell as HTMLElement).dataset.model;\n      if (!vectorStr) return;\n\n      cell.addEventListener('click', () => {\n        try {\n          const vector = JSON.parse(vectorStr) as number[];\n          const stats = this._computeVectorStats(vector);\n          preview.innerHTML = `\n            <div class=\"lq-vector-stats\">\n              <div class=\"lq-stats-header\">${model || `${dim}d vector`}</div>\n              <div class=\"lq-stats-row\"><span>Dimension:</span><span>${vector.length}</span></div>\n              <div class=\"lq-stats-row\"><span>Norm (L2):</span><span>${stats.norm.toFixed(4)}</span></div>\n              <div class=\"lq-stats-row\"><span>Mean:</span><span>${stats.mean.toFixed(4)}</span></div>\n              <div class=\"lq-stats-row\"><span>Std:</span><span>${stats.std.toFixed(4)}</span></div>\n              <div class=\"lq-stats-row\"><span>Min:</span><span>${stats.min.toFixed(4)}</span></div>\n              <div class=\"lq-stats-row\"><span>Max:</span><span>${stats.max.toFixed(4)}</span></div>\n              <div class=\"lq-stats-row\"><span>Sparsity:</span><span>${(stats.sparsity * 100).toFixed(1)}%</span></div>\n            </div>\n          `;\n          preview.style.display = 'block';\n\n          // Position near the cell\n          const rect = (cell as HTMLElement).getBoundingClientRect();\n          preview.style.left = `${rect.right + 10}px`;\n          preview.style.top = `${rect.top}px`;\n        } catch (e) {\n          console.warn('Failed to parse vector:', e);\n        }\n      });\n\n      // Close on click outside\n      document.addEventListener('click', (e) => {\n        if (!cell.contains(e.target as Node) && !preview.contains(e.target as Node)) {\n          preview.style.display = 'none';\n        }\n      }, { once: true });\n    });\n  }\n\n  private _computeVectorStats(values: number[]): {\n    norm: number;\n    mean: number;\n    std: number;\n    min: number;\n    max: number;\n    sparsity: number;\n  } {\n    const n = values.length;\n    if (n === 0) {\n      return { norm: 0, mean: 0, std: 0, min: 0, max: 0, sparsity: 1 };\n    }\n\n    let sum = 0;\n    let sumSq = 0;\n    let min = values[0];\n    let max = values[0];\n    let zeros = 0;\n\n    for (const v of values) {\n      sum += v;\n      sumSq += v * v;\n      if (v < min) min = v;\n      if (v > max) max = v;\n      if (Math.abs(v) < 1e-10) zeros++;\n    }\n\n    const mean = sum / n;\n    const variance = sumSq / n - mean * mean;\n    const std = Math.sqrt(Math.max(0, variance));\n    const norm = Math.sqrt(sumSq);\n    const sparsity = zeros / n;\n\n    return { norm, mean, std, min, max, sparsity };\n  }\n\n  dispose(): void {\n    if (this._comm) {\n      this._comm.close();\n      this._comm = null;\n    }\n    super.dispose();\n  }\n}\n\n/**\n * MIME renderer factory.\n */\nconst rendererFactory: IRenderMime.IRendererFactory = {\n  safe: true,\n  mimeTypes: [MIME_TYPE],\n  createRenderer: (options: IRenderMime.IRendererOptions) => {\n    return new VirtualTableWidget(options);\n  }\n};\n\n/**\n * Main plugin - registers MIME renderer and tracks kernel.\n */\nconst plugin: JupyterFrontEndPlugin<void> = {\n  id: 'lanceql-jupyterlab:plugin',\n  autoStart: true,\n  requires: [IRenderMimeRegistry],\n  optional: [INotebookTracker],\n  activate: (\n    app: JupyterFrontEnd,\n    rendermime: IRenderMimeRegistry,\n    notebookTracker: INotebookTracker | null\n  ) => {\n    console.log('LanceQL: Extension activated');\n\n    // Register MIME renderer\n    rendermime.addFactory(rendererFactory, 0);\n    console.log('LanceQL: MIME renderer registered for', MIME_TYPE);\n\n    if (!notebookTracker) {\n      console.warn('LanceQL: No notebook tracker - Comm will not work');\n      return;\n    }\n\n    // Track kernel\n    const updateKernel = () => {\n      const current = notebookTracker.currentWidget;\n      if (current?.sessionContext?.session?.kernel) {\n        _currentKernel = current.sessionContext.session.kernel;\n        console.log('LanceQL: Kernel connected');\n      } else {\n        _currentKernel = null;\n      }\n    };\n\n    notebookTracker.currentChanged.connect(updateKernel);\n    notebookTracker.widgetAdded.connect((sender, panel) => {\n      panel.sessionContext.kernelChanged.connect(updateKernel);\n      panel.sessionContext.statusChanged.connect(updateKernel);\n    });\n\n    updateKernel();\n  }\n};\n\nexport default plugin;\n"],"names":[],"ignoreList":[],"sourceRoot":""}